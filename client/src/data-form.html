<dom-module id="data-form">

    <template>

        <style include="shared-styles iron-flex iron-flex-alignment">
            .search {
                max-width: 300px;
                margin: 16px auto;
            }

            .search>paper-button {
                max-width: 200px;
            }

            paper-input {
                max-width: 300px;
            }

            .record {
                @apply --layout-horizontal;
            }
            .record > * {
                margin : 8px;
            }
        </style>

        <div class="search layout horizontal">
            <paper-input  value={{searchstring}} placeholder="Search" on-change="dosearch"> </paper-input>
        </div>
        <iron-ajax id="fetch" method="GET" content-type="application/json" on-response="_handleFetchSuccess" on-error="_handleFetchError"></iron-ajax>
        <template is="dom-repeat" items={{list}}>
            <div class="record">
                  <span>[[item.OWNER_NAM]]</span>
                  <span>[[item.GIS_ID]]</span>
                  <span>[[item.ADDRESS]]</span>
            </paper-item>
        </template>
    </template>

    <script>
        Polymer({

            is: 'data-form',

            properties: {
                searchstring: {
                    type: String
                },
                list: {
                    type: Array,
                    value: function () {
                        return [];
                    }
                }
            },
            dosearch: function () {
                if (this.searchstring == "") {
                    this.set('list', []);
                    return;
                }
                if (this.searchstring.length < 3)  {
                    //raise toast
                    return;
                }
                var upperString = this.searchstring.toUpperCase();
                var auth_token = localStorage.getItem('auth_token');
                var filter = {};
                var conditions = [];
                if (this.searchstring.length >= 10) {
                    conditions.push({ MOBILE1: this.searchstring });
                    conditions.push({ MOBILE2: this.searchstring });
                }
                conditions.push({ OWNER_NAM: {like : upperString }});
                conditions.push({ OWNER_NAM: {like : this.searchstring }});
                conditions.push({ GIS_ID: {inq :[upperString, this.searchstring]}});
                filter = {
                    where: {
                        or: conditions
                    },
                    limit: 20
                };
                this.$.fetch.url = "/api/formdata?access_token=" + auth_token + "&filter=" + JSON.stringify(filter);
                this.set('loaderVisible', true);
                //this.$.spinner.active = true;
                //this.$.fetch.body = JSON.stringify(body);
                this.$.fetch.generateRequest();
            },
            _handleFetchSuccess: function (e) {
                this.set('list', e.detail.response);
                console.log('number of forms found ', this.list.length);
            },
            _handleFetchError: function (e) {

            }

        });
    </script>
</dom-module>